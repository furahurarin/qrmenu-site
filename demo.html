<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>メニュー（デモ表示）</title>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";margin:0;color:#111}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    table{border-collapse:collapse;width:100%;min-width:900px}
    th,td{border-bottom:1px solid #eee;padding:8px 10px;text-align:left;vertical-align:top}
    thead th{background:#f7f7f7}
    .box{overflow:auto;border:1px solid #eee;border-radius:12px}
  </style>
</head>
<body>
  <main class="wrap">
    <h1>メニュー（デモ表示）</h1>
    <p>この表は <code>menu_demo.csv</code> を読み込んで表示しています。</p>
    <div id="status">読み込み中…</div>
    <div class="box"><table id="tbl" hidden></table></div>
  </main>
  <script>
    function parseCSV(text){
      const rows=[]; let i=0,f="",row=[],q=false;
      while(i<text.length){
        const c=text[i];
        if(c==='\"'){ if(q && text[i+1]==='\"'){ f+='\"'; i+=2; continue;} q=!q; i++; continue;}
        if(!q && (c===','||c==='\n'||c==='\r')){ row.push(f); f="";
          if(c===','){i++;continue;}
          if(c==='\r'&&text[i+1]==='\n') i++;
          rows.push(row); row=[]; i++; continue;
        }
        f+=c; i++;
      }
      if(f.length || row.length){ row.push(f); rows.push(row); }
      return rows;
    }
    fetch("./menu_demo.csv",{cache:"no-store"})
      .then(r=>{if(!r.ok) throw new Error("CSV not found"); return r.text();})
      .then(t=>{
        const rows=parseCSV(t);
        const tbl=document.getElementById("tbl");
        const st=document.getElementById("status");
        if(!rows || !rows.length){ st.textContent="データが空です"; return; }
        const thead=document.createElement("thead");
        const htr=document.createElement("tr");
        rows[0].forEach(h=>{ const th=document.createElement("th"); th.textContent=h; htr.appendChild(th); });
        thead.appendChild(htr); tbl.appendChild(thead);
        const tbody=document.createElement("tbody");
        rows.slice(1).forEach(r=>{
          const tr=document.createElement("tr");
          r.forEach(c=>{ const td=document.createElement("td"); td.textContent=c; tr.appendChild(td); });
          tbody.appendChild(tr);
        });
        tbl.appendChild(tbody);
        tbl.hidden=false; st.remove();
      })
      .catch(e=>{ document.getElementById("status").textContent="読み込みエラー："+e.message; });
  </script>
</body>
</html>
